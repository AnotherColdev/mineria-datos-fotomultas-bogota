---
title: "Comparendos en Bogotá Colombia 2021"
author: "Santiago Calderón, Juan Fajardo, Carlos Gutierrez"
date: "2024-10-16"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# 1. Introducción
El proceso KDD permite transformar grandes volúmenes de información en conocimiento útil. En este proyecto aplicamos el enfoque KDD utilizando técnicas de clustering para analizar los comparendos registrados en Bogotá, Colombia en el año 2021, con el objetivo de identificar patrones y agrupaciones que permitan comprender mejor las características de las infracciones de tránsito y cómo estas varían según factores como la ubicación, el tipo de infracción, fecha, entre otros.

# 2. Justificación
El análisis de los comparendos de tránsito es crucial para mejorar la gestión y las políticas públicas relacionadas con la movilidad y la seguridad vial. Los datos de comparendos registrados en Bogotá, Colombia en 2021, permitirán comprender las zonas y fechas con mayores infracciones y las infracciones más comunes. El uso de técnicas de clustering nos ayudará a segmentar los datos, facilitando la creación de perfiles de infractores o zonas críticas, lo que puede ser utilizado por autoridades de tránsito para tomar decisiones más informadas.

# 3. Objetivos
## 3.1. Objetivo General
Identificar patrones y agrupaciones en los comparendos registrados en Bogotá Colombia en 2021 registrados según su zona, tipo de vehículo y fecha y hora mediante técnicas de clustering, para mejorar el entendimiento de las infracciones de tránsito y su distribución geográfica y temporal, permitiendo plantear estrategias que permitan reducir la incurrencia en este tipo de infracciones

## 3.2. Objetivos Especificos

•	Seleccionar y preprocesar los datos de comparendos de manera adecuada para su análisis.

•	Aplicar técnicas de clustering para segmentar los comparendos

•	Analizar las características de los clusters identificados y proponer recomendaciones basadas en los resultados.

•	Identificar zonas con mayor incidencia de infracciones y de qué tipo.

•	Determinar en qué horarios y días de la semana se registran más infracciones.

•	Agrupar las infracciones por tipo y analizar factores comunes (vehículos, hora, dirección).

# 4. Fases del proceso KDD
## 4.1. Dominio del problema

Los comparendos de tránsito son sanciones impuestas a los conductores por infringir las normas de tránsito. En Colombia, estas infracciones incluyen desde el mal estacionamiento hasta conducir bajo la influencia de alcohol. En este análisis, nos enfocamos en identificar patrones recurrentes y áreas críticas de infracciones. Las variables principales consideradas incluyen la fecha de la infracción, la ubicación geográfica, y el tipo de infracción.

El problema consiste en analizar grandes volúmenes de datos sobre infracciones de tránsito ocurridas en Colombia en 2021, con el objetivo de agrupar estas infracciones en clústeres que compartan características comunes. Esto permitiría identificar patrones geográficos o temporales relacionados con el tipo de infracción para generar insights valiosos, como áreas con mayor incidencia u horarios críticos en los que ocurren las infracciones.


## 4.2. Selección de los datos
Actualmente el dataset cuenta con mas de 480000 filas y 16 columnas. Al revisar el contenido se procede a escoger las columnas que seran utilizadas para este proyecto, pasando a 11 columnas, a continuación se detallan:

•	NUM_COMPAR: Numero de comparendo en el que es cargado la información del comparendo

•	FECHA_HORA: Registra la fecha y la hora en la que el comparendo fue subido al sistema

• HORA_OCURR: Hora en la que es tomado el comparendo

•	MEDIO_DETE:	Medio por el que fue registrado el comparendo

• CLASE_VEHI:	Tipo de vehículo al que se realiza el comparendo

• TIPO_SERVI:	Servicio que ofrece el vehículo

• INFRACCION:	Id de la infracción cometida

• DES_INFRAC:	Descripción de la infracción

• LOCALIDAD:	Localidad en la que ocurren los hechos

• DIRECCION:	Dirección donde ocurren los hechos


Variables Clave Para lograr los objetivos del proyecto, se utilizarán las siguientes variables:

•	Fecha y hora: Para identificar patrones temporales.

•	Localidad y dirección: Para analizar la distribución geográfica de las 
infracciones.

•	Tipo de infracción: Para categorizar y entender la naturaleza de las 
infracciones.

•	Tipo de vehículo: Para analizar las infracciones según el tipo de vehículo y su uso.

Estas variables nos proveen la información necesaria para el cumplimiento de los objetivos del proyecto, al darnos la información necesaria del lugar, hora, tipo de infracción y tipo de vehículo involucrado, excluyendo la información extra que para el caso no es relevante, como el medio de detección utilizado y el tipo de servicio del vehículo (publico/particular)



```{r, message=FALSE, warning=FALSE}
library(readr)
library(dplyr)
library(tidyverse)
library(VIM)
library(scales)
library(lubridate)
library(caret)
library(knitr)
library(kableExtra)


#Cargar el dataset
estudio <- read_csv("./src/Comparendos_2021_Bogota_D_C.csv")

#Filtrar solo las columnas necesarias
estudio <- estudio %>% select(NUM_COMPAR, FECHA_HORA, HORA_OCURR, MEDIO_DETE, CLASE_VEHI, TIPO_SERVI, INFRACCION, DES_INFRAC, LOCALIDAD, DIRECCION)



# Obtener los nombres de las columnas
nombres_columnas <- colnames(estudio)

# Crear una tabla con los nombres de las columnas en forma de lista
kable(as.data.frame(nombres_columnas), col.names = NULL, "latex", booktabs = TRUE)
```


## 4.3. Limpieza de los datos
```{r cars}


# 1. Eliminar filas que no contienen ningún valor (filas completamente vacías)
estudio <- estudio %>% filter(!if_all(everything(), is.na))

# 2. Eliminar columnas que están completamente vacías
estudio <- estudio %>% select_if(~ !all(is.na(.)))

# 3. Eliminar filas duplicadas
duplicated_rows <- estudio %>% duplicated()
print(paste("Número de filas duplicadas:", sum(duplicated_rows)))
estudio <- estudio %>% distinct()  # Eliminar filas duplicadas, si existen



```

## 4.4. Transformación de datos
```{r}
# 5. Reemplazar "-" en las columnas CLASE_VEHI y TIPO_SERVI por "Peatón"
estudio <- estudio %>% 
  mutate(CLASE_VEHI = ifelse(CLASE_VEHI == "-" | is.na(CLASE_VEHI), "Peatón", CLASE_VEHI),
         TIPO_SERVI = ifelse(TIPO_SERVI == "-" | is.na(TIPO_SERVI), "Peatón", TIPO_SERVI))

# 6. Convertir la columna FECHA_HORA a formato de fecha y hora
estudio <- estudio %>%
  mutate(FECHA_HORA = ymd_hms(FECHA_HORA, tz = "UTC"))  # Convierte FECHA_HORA al formato de fecha y hora

#Imprimir las columas seleccionadas
result <- estudio %>%
  select(FECHA_HORA, HORA_OCURR,CLASE_VEHI, TIPO_SERVI)

print(result)

# Revisar que se haya realizado la conversión correctamente
str(estudio$FECHA_HORA)
head(estudio$FECHA_HORA)

# 7. Identificación de valores faltantes por columna
missing_values <- colSums(is.na(estudio))  
print("Valores faltantes por columna:")
print(missing_values)

# 8. Visualizar proporción de valores faltantes
missing_percentage <- (missing_values / nrow(estudio)) * 100
print("Porcentaje de valores faltantes por columna:")
print(missing_percentage)

# 9. Convertir variables de tipo character a factor
estudio <- estudio %>%
  mutate(across(where(is.character), as.factor))

# 10. Escalar variables numéricas
numeric_vars <- estudio %>% select_if(is.numeric) %>% names()
estudio_scaled <- estudio
estudio_scaled[numeric_vars] <- scale(estudio_scaled[numeric_vars])

# 11. Verificar nuevamente si hay columnas con todos los valores faltantes
estudio_scaled <- estudio_scaled %>% select_if(~ !all(is.na(.)))

# 12. Aplicar KNN para imputación de datos faltantes
estudio_imputado_knn <- tryCatch(
  {
    kNN(estudio_scaled, k = 5, imp_var = FALSE)
  },
  error = function(e) {
    message("Error en la imputación KNN: ", e$message)
    NULL
  }
)

# 13. Verificar si la imputación fue exitosa
if (!is.null(estudio_imputado_knn)) {

  missing_after_knn <- colSums(is.na(estudio_imputado_knn))
  print("Valores faltantes después de la imputación:")
  print(missing_after_knn)

} else {
  print("La imputación KNN no fue exitosa.")
}

```